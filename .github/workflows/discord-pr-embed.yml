name: Discord PR Embed Notifications

on:
  pull_request:
    types: [opened, closed, reopened]

jobs:
  notify-discord:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord Embed
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const webhookUrl = process.env.DISCORD_WEBHOOK;
            const pr = github.event.pull_request;

            let color = 0x00ff00; // green
            let action = github.event.action;

            if(action === "closed") {
              if(pr.merged) {
                color = 0x0000ff; // blue for merged
                action = "merged";
              } else {
                color = 0xff0000; // red for closed/unmerged
              }
            }

            const embed = {
              title: `${pr.title}`,
              url: pr.html_url,
              color: color,
              author: {
                name: pr.user.login,
                icon_url: pr.user.avatar_url
              },
              fields: [
                { name: "Action", value: action, inline: true },
                { name: "Branch", value: pr.head.ref, inline: true },
                { name: "Base", value: pr.base.ref, inline: true }
              ],
              timestamp: new Date()
            };

            await require('axios').default.post(webhookUrl, { embeds: [embed] });
